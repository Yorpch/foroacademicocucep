<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>CUCEP - Inicio</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&amp;display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: modalSlideIn 0.3s ease-out;
    }
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
          },
          fontFamily: {
            "display": ["Inter"]
          },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
        },
      },
    }
  </script>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
  <div class="relative flex min-h-screen flex-col">

    <!-- Modal de confirmaci√≥n de logout -->
    <div id="logoutModal" class="modal-overlay">
      <div class="modal-content dark:bg-gray-800 dark:text-white">
        <div class="text-center mb-6">
          <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
            <span class="material-symbols-outlined text-blue-600 dark:text-blue-300 text-2xl">
              logout
            </span>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
            ¬øCerrar sesi√≥n?
          </h3>
          <p class="text-gray-600 dark:text-gray-300">
            ¬øEst√°s seguro de que quieres salir de tu cuenta?
          </p>
        </div>
        
        <div class="flex flex-col gap-3">
          <button id="confirmLogout" 
            class="w-full py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors">
            S√≠, cerrar sesi√≥n
          </button>
          <button id="cancelLogout" 
            class="w-full py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium rounded-lg transition-colors">
            Cancelar
          </button>
        </div>
        
        <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 text-center">
          <p class="text-sm text-gray-500 dark:text-gray-400">
            Volver√°s a la p√°gina de inicio de sesi√≥n
          </p>
        </div>
      </div>
    </div>

    <header
      class="sticky top-0 z-50 flex h-16 w-full items-center justify-center bg-white/80 dark:bg-background-dark/80 backdrop-blur-sm shadow-sm">
      <nav class="flex w-full max-w-5xl items-center justify-between px-6">
        <div class="flex items-center gap-2">
          <h2 class="text-xl font-bold tracking-tight text-[#111418] dark:text-white">CUCEP</h2>
        </div>
        
        <!-- Men√∫ de usuario para m√≥viles (icono) -->
        <div class="md:hidden flex items-center gap-4">
          <div class="relative">
            <button id="mobileMenuBtn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-primary">
              <span class="material-symbols-outlined">
                account_circle
              </span>
            </button>
            
            <!-- Men√∫ desplegable m√≥vil -->
            <div id="mobileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg py-2 z-50 border border-gray-200 dark:border-gray-700">
              <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700">
                <p class="text-sm font-medium text-gray-900 dark:text-white" id="mobileUserName"></p>
                <p class="text-xs text-gray-500 dark:text-gray-400" id="mobileUserEmail"></p>
              </div>
              <a href="foro.html" class="flex items-center gap-2 px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                <span class="material-symbols-outlined text-sm">forum</span>
                Foros
              </a>
              <a href="canal.html" class="flex items-center gap-2 px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                <span class="material-symbols-outlined text-sm">chat</span>
                Canales
              </a>
              <div class="border-t border-gray-100 dark:border-gray-700"></div>
              <button id="mobileLogoutBtn" class="w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20">
                <span class="material-symbols-outlined text-sm">logout</span>
                Cerrar sesi√≥n
              </button>
            </div>
          </div>
          <button id="mobileMenuToggle" class="text-gray-600 dark:text-gray-300">
            <span class="material-symbols-outlined">
              menu
            </span>
          </button>
        </div>

        <!-- Men√∫ de escritorio -->
        <div class="hidden md:flex items-center gap-8">
          <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2"
            href="#">
            <span class="material-symbols-outlined text-base">home</span>
            Inicio
          </a>
          <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2"
            href="foro.html">
            <span class="material-symbols-outlined text-base">forum</span>
            Foros
          </a>
          <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors flex items-center gap-2"
            href="canal.html">
            <span class="material-symbols-outlined text-base">chat</span>
            Canales
          </a>
          
          <!-- Dropdown de usuario para escritorio -->
          <div class="relative">
            <button id="userMenuBtn" class="flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors">
              <span class="material-symbols-outlined text-base">
                account_circle
              </span>
              <span id="userNameNav">Mi cuenta</span>
              <span class="material-symbols-outlined text-base">
                expand_more
              </span>
            </button>
            
            <!-- Men√∫ desplegable -->
            <div id="userDropdown" class="hidden absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg py-2 z-50 border border-gray-200 dark:border-gray-700">
              <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700">
                <p class="text-sm font-medium text-gray-900 dark:text-white" id="dropdownUserName"></p>
                <p class="text-xs text-gray-500 dark:text-gray-400" id="dropdownUserEmail"></p>
                <p class="text-xs mt-1">
                  <span class="inline-block px-2 py-1 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300" id="dropdownUserRole">
                    Usuario
                  </span>
                </p>
              </div>
              
              <a href="perfil.html" class="flex items-center gap-2 px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                <span class="material-symbols-outlined text-sm">person</span>
                Mi perfil
              </a>
              
              <a href="configuracion.html" class="flex items-center gap-2 px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                <span class="material-symbols-outlined text-sm">settings</span>
                Configuraci√≥n
              </a>
              
              <div id="adminMenuItems" class="hidden">
                <div class="border-t border-gray-100 dark:border-gray-700 my-2"></div>
                <p class="px-4 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                  Administraci√≥n
                </p>
                <a href="dashboard_admin.html" class="flex items-center gap-2 px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                  <span class="material-symbols-outlined text-sm">dashboard</span>
                  Panel de control
                </a>
              </div>
              
              <div class="border-t border-gray-100 dark:border-gray-700 mt-2"></div>
              <button id="logoutBtnDesktop" class="w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20">
                <span class="material-symbols-outlined text-sm">logout</span>
                Cerrar sesi√≥n
              </button>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="flex flex-1 items-center justify-center py-12 px-6">
      <div class="w-full max-w-2xl text-center">

        <h1 id="titulo-principal" class="text-4xl font-bold tracking-tight text-[#111418] dark:text-white md:text-5xl">
          Explora la comunidad de CUCEP
        </h1>

        <p id="subtitulo" class="mt-4 text-base text-gray-600 dark:text-gray-300 md:text-lg">
          Participa en foros, √∫nete a canales y comparte conocimiento con otros usuarios.
        </p>

        <div class="mt-8 flex flex-col items-center gap-4 sm:flex-row sm:justify-center">
          <a href="foro.html"
            class="flex w-full items-center justify-center rounded-lg h-12 px-6 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] transition-transform hover:scale-105 sm:w-auto">
            Ver foros
          </a>
          <a href="canal.html"
            class="flex w-full items-center justify-center rounded-lg h-12 px-6 bg-white dark:bg-transparent border border-primary text-primary text-base font-bold leading-normal tracking-[0.015em] transition-transform hover:scale-105 sm:w-auto">
            Explorar canales
          </a>
          
          <!-- Bot√≥n para administradores -->
          <a id="admin-btn" href="dashboard_admin.html"
            class="flex w-full items-center justify-center rounded-lg h-12 px-6 bg-green-600 text-white text-base font-bold leading-normal tracking-[0.015em] transition-transform hover:scale-105 sm:w-auto hidden">
            Panel Administrativo
          </a>
        </div>

        <!-- Tarjeta de bienvenida del usuario -->
        <div id="userWelcomeCard" class="mt-12 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 max-w-md mx-auto hidden">
          <div class="flex items-center gap-4 mb-4">
            <div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
              <span class="material-symbols-outlined text-blue-600 dark:text-blue-300 text-2xl">
                account_circle
              </span>
            </div>
            <div class="text-left">
              <h3 class="font-semibold text-gray-900 dark:text-white" id="welcomeUserName"></h3>
              <p class="text-sm text-gray-500 dark:text-gray-400" id="welcomeUserRole"></p>
            </div>
          </div>
          <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
            Bienvenido de nuevo a la plataforma CUCEP. Tu √∫ltima actividad fue 
            <span id="lastActivity" class="font-medium">hoy</span>.
          </p>
          <div class="flex gap-2">
            <button onclick="mostrarModalLogout()" class="text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 flex items-center gap-1">
              <span class="material-symbols-outlined text-sm">logout</span>
              Cerrar sesi√≥n
            </button>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- INTEGRACI√ìN CON BACKEND -->
  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  
  <script>
    // Funciones para mostrar/ocultar modales
    function mostrarModalLogout() {
      document.getElementById('logoutModal').classList.add('active');
    }
    
    function ocultarModalLogout() {
      document.getElementById('logoutModal').classList.remove('active');
    }
    
    // Cerrar modal al hacer clic fuera
    document.getElementById('logoutModal').addEventListener('click', function(e) {
      if (e.target === this) {
        ocultarModalLogout();
      }
    });
    
    // Configurar botones de logout
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar autenticaci√≥n
      if (!api.isAuthenticated()) {
        window.location.href = '/login.html';
        return;
      }

      const user = api.getUserData();
      const nombreCompleto = api.getNombreCompleto();
      
      // ============================================
      // CONFIGURAR INTERFAZ DE USUARIO
      // ============================================
      
      // 1. Actualizar navegaci√≥n
      if (nombreCompleto) {
        // Men√∫ de escritorio
        const userNameNav = document.getElementById('userNameNav');
        const dropdownUserName = document.getElementById('dropdownUserName');
        const mobileUserName = document.getElementById('mobileUserName');
        const welcomeUserName = document.getElementById('welcomeUserName');
        
        if (userNameNav) userNameNav.textContent = nombreCompleto.split(' ')[0]; // Solo nombre
        if (dropdownUserName) dropdownUserName.textContent = nombreCompleto;
        if (mobileUserName) mobileUserName.textContent = nombreCompleto;
        if (welcomeUserName) welcomeUserName.textContent = `¬°Hola, ${nombreCompleto}!`;
      }
      
      // 2. Actualizar email
      const dropdownUserEmail = document.getElementById('dropdownUserEmail');
      const mobileUserEmail = document.getElementById('mobileUserEmail');
      if (dropdownUserEmail && user.email) dropdownUserEmail.textContent = user.email;
      if (mobileUserEmail && user.email) mobileUserEmail.textContent = user.email;
      
      // 3. Actualizar rol
      const dropdownUserRole = document.getElementById('dropdownUserRole');
      const welcomeUserRole = document.getElementById('welcomeUserRole');
      const adminMenuItems = document.getElementById('adminMenuItems');
      const adminBtn = document.getElementById('admin-btn');
      
      let rolTexto = 'Usuario';
      if (user.rol_id === 1 || user.tipo === 'administrador') {
        rolTexto = 'üëë Administrador';
        if (adminMenuItems) adminMenuItems.classList.remove('hidden');
        if (adminBtn) adminBtn.classList.remove('hidden');
      } else if (user.rol_id === 2 || user.tipo === 'profesor') {
        rolTexto = 'üë®‚Äçüè´ Profesor';
      } else if (user.rol_id === 3) {
        rolTexto = 'üë®‚Äçüéì Estudiante';
      }
      
      if (dropdownUserRole) dropdownUserRole.textContent = rolTexto;
      if (welcomeUserRole) welcomeUserRole.textContent = rolTexto;
      
      // 4. Mostrar tarjeta de bienvenida
      const userWelcomeCard = document.getElementById('userWelcomeCard');
      if (userWelcomeCard) userWelcomeCard.classList.remove('hidden');
      
      // 5. Personalizar contenido principal
      const titulo = document.getElementById('titulo-principal');
      const subtitulo = document.getElementById('subtitulo');
      
      if (titulo && nombreCompleto) {
        titulo.textContent = `¬°Hola ${nombreCompleto.split(' ')[0]}, bienvenido a CUCEP!`;
      }
      
      if (subtitulo) {
        let textoSubtitulo = 'Participa en foros, √∫nete a canales y comparte conocimiento.';
        if (user.rol_id === 2 || user.tipo === 'profesor') {
          textoSubtitulo = 'Comparte tu conocimiento con estudiantes y otros profesores.';
        } else if (user.rol_id === 1 || user.tipo === 'administrador') {
          textoSubtitulo = 'Gestiona la plataforma y participa en la comunidad acad√©mica.';
        }
        subtitulo.textContent = textoSubtitulo;
      }
      
      // ============================================
      // CONFIGURAR EVENTOS DE LOGOUT
      // ============================================
      
      // 1. Bot√≥n de logout en modal
      document.getElementById('confirmLogout').addEventListener('click', async function() {
        console.log('Confirmando logout...');
        this.disabled = true;
        this.textContent = 'Cerrando sesi√≥n...';
        
        await api.logout();
        ocultarModalLogout();
      });
      
      // 2. Cancelar logout
      document.getElementById('cancelLogout').addEventListener('click', ocultarModalLogout);
      
      // 3. Bot√≥n de logout en men√∫ de escritorio
      const logoutBtnDesktop = document.getElementById('logoutBtnDesktop');
      if (logoutBtnDesktop) {
        logoutBtnDesktop.addEventListener('click', mostrarModalLogout);
      }
      
      // 4. Bot√≥n de logout en men√∫ m√≥vil
      const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
      if (mobileLogoutBtn) {
        mobileLogoutBtn.addEventListener('click', mostrarModalLogout);
      }
      
      // 5. Men√∫s desplegables
      const userMenuBtn = document.getElementById('userMenuBtn');
      const userDropdown = document.getElementById('userDropdown');
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const mobileDropdown = document.getElementById('mobileDropdown');
      
      if (userMenuBtn && userDropdown) {
        userMenuBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          userDropdown.classList.toggle('hidden');
        });
        
        // Cerrar al hacer clic fuera
        document.addEventListener('click', function(e) {
          if (!userDropdown.contains(e.target) && !userMenuBtn.contains(e.target)) {
            userDropdown.classList.add('hidden');
          }
        });
      }
      
      if (mobileMenuBtn && mobileDropdown) {
        mobileMenuBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          mobileDropdown.classList.toggle('hidden');
        });
        
        // Cerrar al hacer clic fuera
        document.addEventListener('click', function(e) {
          if (!mobileDropdown.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
            mobileDropdown.classList.add('hidden');
          }
        });
      }
      
      // 6. Men√∫ m√≥vil principal
      const mobileMenuToggle = document.getElementById('mobileMenuToggle');
      if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', function() {
          alert('Men√∫ m√≥vil - Aqu√≠ ir√≠an las opciones de navegaci√≥n m√≥vil');
          // En una implementaci√≥n completa, aqu√≠ se mostrar√≠a un men√∫ lateral
        });
      }
      
      // ============================================
      // CONFIGURACI√ìN ADICIONAL
      // ============================================
      
      // Cargar √∫ltima actividad
      const lastActivity = document.getElementById('lastActivity');
      if (lastActivity) {
        const loginTime = localStorage.getItem('login_time');
        if (loginTime) {
          const loginDate = new Date(parseInt(loginTime));
          const ahora = new Date();
          const diffHoras = Math.floor((ahora - loginDate) / (1000 * 60 * 60));
          
          if (diffHoras < 1) {
            lastActivity.textContent = 'hace menos de una hora';
          } else if (diffHoras < 24) {
            lastActivity.textContent = `hace ${diffHoras} hora${diffHoras !== 1 ? 's' : ''}`;
          } else {
            lastActivity.textContent = loginDate.toLocaleDateString('es-ES');
          }
        }
      }
      
      // Prevenir navegaci√≥n atr√°s despu√©s de logout
      window.addEventListener('pageshow', function(event) {
        if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
          // Si viene de cach√© (back/forward), verificar sesi√≥n
          if (!api.isAuthenticated()) {
            window.location.href = '/login.html';
          }
        }
      });
      
      // Guardar actividad peri√≥dica
      setInterval(() => {
        localStorage.setItem('ultima_actividad', Date.now().toString());
      }, 60000); // Cada minuto
      
      console.log('‚úÖ Interfaz configurada para:', nombreCompleto);
    });
    
    // Funci√≥n global para logout (desde cualquier lugar)
    window.logoutUsuario = function() {
      mostrarModalLogout();
    };
  </script>
</body>
</html>